<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Flood warning</title>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/jquery.knob/1.2.13/jquery.knob.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    .dial-container {
      display: inline-block;
      margin-right: 25px;
      margin-bottom: 25px;
    }
    #map {
  border: 2px solid black;
}


  </style>
</head>

<body>
  {{> menu}}
  <div class="container-fluid">
    <br></br>
    <div class="row">
      <div class="col-12 col-lg-6 col-xl-6">
        <div id="map" style="width: 100%; height: 100%;"></div>
      </div>
      <div class="col-12 col-lg-6 col-xl-6">
            <div class="row ">
      <div class="col-6 col-lg-6 col-xl-5">
        <div class="dial-container">
          <input id="distance" type="text" class="dial" data-min="0" data-max="200" data-width="150" data-height="150"
            data-thickness=".2" data-fgColor="#66CC66" data-displayPrevious=true readonly>
          <p class="text-center"><label>Khoảng cách (cm)</label></p>
        </div>
      </div>
      <div class="col-6 col-lg-6 col-xl-5">
        <div class="dial-container">
          <input id="average" type="text" class="dial" data-min="0" data-max="200" data-width="150" data-height="150"
            data-thickness=".2" data-fgColor="#FF6699" data-displayPrevious=true readonly>
          <p class="text-center"><label>Trung bình</label></p>
        </div>
      </div>
    </div>
    <div class="row ">
      <div class="col-6 col-lg-6 col-xl-5">
        <div class="dial-container">
          <input id="temperature" type="text" class="dial" data-min="0" data-max="100" data-width="150" data-height="150"
            data-height="200" data-thickness=".2" data-fgColor="#FFCC33" data-displayPrevious=true readonly>
          <p class="text-center"><label>Nhiệt độ (°C)</label></p>
        </div>
      </div>
      <div class="col-6 col-lg-6 col-xl-5">
        <div class="dial-container">
          <input id="humidity" type="text" class="dial" data-min="0" data-max="100" data-width="150" data-height="150"
            data-thickness=".2" data-fgColor="#3399FF" data-displayPrevious=true readonly>
          <p class="text-center"><label>Độ ẩm (%)</label></p>
        </div>
      </div>
    </div>
      </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBWLBY90a5gSGOjoerUeHF5bfsNdMJcOAA&callback=initMap"> </script>
  <script>
    $(function () {
      $(".dial").knob({
        'readOnly': true // Set readOnly option to true
      });
    });
    const socket = io();
    socket.on('data', (data) => {
      $('#distance').val(data.distance).trigger('change');
      $('#temperature').val(data.temperature).trigger('change');
      $('#humidity').val(data.humidity).trigger('change');
      $('#average').val(data.average).trigger('change');
      $('#warning').text(data.warning);
    });
    function initMap() {
  // Tạo một đối tượng map mới
  var myLatLng = {lat: 10.829804, lng: 106.6918857};

    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 8,
      center: myLatLng
    });

    var marker = new google.maps.Marker({
      position: myLatLng,
      map: map,
      title: 'Hello World!'
    });

  // Thêm một sự kiện click vào marker để hiển thị các giá trị trong socket
  marker.addListener("click", () => {
    const infowindow = new google.maps.InfoWindow({
      content: `
        <div>
          <p>Khu vực 1</p>
          <p>Distance: <span id="distance"></span></p>
          <p>Temperature: <span id="temperature"></span></p>
          <p>Humidity: <span id="humidity"></span></p>
          <p>Average: <span id="average"></span></p>
          <p>Warning: <span id="warning"></span></p>
        </div>
      `,
    });

    // Mở thông báo
    infowindow.open({
      anchor: marker,
      map,
      shouldFocus: false,
    });

    // Cập nhật các giá trị trong socket vào thông báo
    socket.on("data", (data) => {
      $("#distance").text(data.distance);
      $("#temperature").text(data.temperature);
      $("#humidity").text(data.humidity);
      $("#average").text(data.average);
      $("#warning").text(data.warning);
    });
  });
}

// Load Google Maps API và gọi hàm initMap khi đã tải xong
const script = document.createElement("script");
script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyBWLBY90a5gSGOjoerUeHF5bfsNdMJcOAA&callback=initMap`;
document.body.appendChild(script);

  </script>
</body>

</html>